<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.feng.oldfriend.dao.LyjRequirementApplyMapper" >
  <resultMap id="BaseResultMap" type="com.feng.oldfriend.entity.LyjRequirementApply" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="lyj_requirement_applyid" property="lyjRequirementApplyid" jdbcType="INTEGER" />
    <result column="lyj_user_id" property="lyjUserId" jdbcType="INTEGER" />
    <result column="lyj_volunteer_id" property="lyjVolunteerId" jdbcType="INTEGER" />
    <result column="lyj_requirement_applystate" property="lyjRequirementApplystate" jdbcType="INTEGER" />
    <result column="lyj_requirement_applycomment" property="lyjRequirementApplycomment" jdbcType="VARCHAR" />
    <result column="lyj_requirement_applystar" property="lyjRequirementApplystar" jdbcType="INTEGER" />
    <result column="lyj_requirement_applyrequirementid" property="lyjRequirementApplyrequirementid" jdbcType="INTEGER" />
    <result column="lyj_requirement_applyduration" property="lyjRequirementApplyduration" jdbcType="INTEGER" />
  </resultMap>

  <sql id="Base_Column_List">
      lyj_requirement_apply.lyj_requirement_applyid,
      lyj_requirement_apply.lyj_user_id,
      lyj_requirement_apply.lyj_volunteer_id,
      lyj_requirement_apply.lyj_requirement_applystate,
      lyj_requirement_apply.lyj_requirement_applycomment,
      lyj_requirement_apply.lyj_requirement_applystar,
      lyj_requirement_apply.lyj_requirement_applyrequirementid,
      lyj_requirement_apply.lyj_requirement_applyduration
  </sql>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from lyj_requirement_apply
    where lyj_requirement_applyid = #{lyjRequirementApplyid,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.feng.oldfriend.entity.LyjRequirementApply" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into lyj_requirement_apply (lyj_requirement_applyid, lyj_user_id, 
      lyj_volunteer_id, lyj_requirement_applystate, 
      lyj_requirement_applycomment, lyj_requirement_applystar, 
      lyj_requirement_applyrequirementid, lyj_requirement_applyduration
      )
    values (#{lyjRequirementApplyid,jdbcType=INTEGER}, #{lyjUserId,jdbcType=INTEGER}, 
      #{lyjVolunteerId,jdbcType=INTEGER}, #{lyjRequirementApplystate,jdbcType=INTEGER}, 
      #{lyjRequirementApplycomment,jdbcType=VARCHAR}, #{lyjRequirementApplystar,jdbcType=INTEGER}, 
      #{lyjRequirementApplyrequirementid,jdbcType=INTEGER}, #{lyjRequirementApplyduration,jdbcType=INTEGER}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.feng.oldfriend.entity.LyjRequirementApply" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update lyj_requirement_apply
    set lyj_user_id = #{lyjUserId,jdbcType=INTEGER},
      lyj_volunteer_id = #{lyjVolunteerId,jdbcType=INTEGER},
      lyj_requirement_applystate = #{lyjRequirementApplystate,jdbcType=INTEGER},
      lyj_requirement_applycomment = #{lyjRequirementApplycomment,jdbcType=VARCHAR},
      lyj_requirement_applystar = #{lyjRequirementApplystar,jdbcType=INTEGER},
      lyj_requirement_applyrequirementid = #{lyjRequirementApplyrequirementid,jdbcType=INTEGER},
      lyj_requirement_applyduration = #{lyjRequirementApplyduration,jdbcType=INTEGER}
    where lyj_requirement_applyid = #{lyjRequirementApplyid,jdbcType=INTEGER}
  </update>

  <!--将除了某个申请ID外的其他同一申请需求的申请置为申请失败-->
  <update id="updateApplyFailed">
    update lyj_requirement_apply
    set lyj_requirement_applystate = #{lyjRequirementApplystate,jdbcType=INTEGER}
    where lyj_requirement_applyid = #{requirementApplyId,jdbcType=INTEGER}
    and lyj_requirement_applyrequirementid=#{requirementId,jdbcType=INTEGER}
  </update>

  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select lyj_requirement_applyid, lyj_user_id, lyj_volunteer_id, lyj_requirement_applystate, 
    lyj_requirement_applycomment, lyj_requirement_applystar, lyj_requirement_applyrequirementid, 
    lyj_requirement_applyduration
    from lyj_requirement_apply
    where lyj_requirement_applyid = #{lyjRequirementApplyid,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select lyj_requirement_applyid, lyj_user_id, lyj_volunteer_id, lyj_requirement_applystate, 
    lyj_requirement_applycomment, lyj_requirement_applystar, lyj_requirement_applyrequirementid, 
    lyj_requirement_applyduration
    from lyj_requirement_apply
  </select>

  <!--根据需求ID查询所有的申请-->
  <select id="selectByRequirementId" resultMap="BaseResultMap" >
    select
    <include refid="Base_Column_List"/>
    from lyj_requirement_apply
    <if test="lyjRequirementId!=null and lyjRequirementId!=0 ">
      where lyj_requirement_applyrequirementid= #{lyjRequirementId,jdbcType=DECIMAL}
    </if>
  </select>

  <!--根据搜索内容进行查找数据-->
  <select id="getLyjRequirements" resultMap="BaseResultMap">

    <bind name="pattern" value="'%' + searchText + '%'"/>
    select
    <include refid="Base_Column_List"/>
    from lyj_requirement
    <where>
      <if test="searchText!=null and searchText!='' ">
        (
        lyj_requirement_name like #{pattern}
        or lyj_requirement_description like #{pattern}
        or lyj_requirement_city like #{pattern}
        or lyj_requirement_area like #{pattern}
        or lyj_requirement_street like #{pattern}
        or lyj_requirement_rawaddress like #{pattern}
        )
      </if>
    </where>
    order by lyj_requirement_id

  </select>

  <!--根据参数(搜索内容,创建人ID，需求的状态)进行查找-->
  <select id="getRequirementByParams"  resultType="com.feng.oldfriend.entity.LyjRequirementApplyField">
      <bind name="pattern" value="'%' + searchText + '%'"/>
    SELECT
        lyj_requirement_applyid,
        lyj_user_id,
        lyj_volunteer_id,
        lyj_requirement_applystate,
        lyj_requirement_applycomment,
        lyj_requirement_applystar,
        lyj_requirement_applyrequirementid,
        lyj_requirement_applyduration,
        lyj_requirement_id,
        lyj_requirement_name,
        lyj_requirement_description,
        lyj_requirement_createuser,
        lyj_requirement_applyuser,
        lyj_requirement_isvolunteer,
        lyj_requirement_city,
        lyj_requirement_area,
        lyj_requirement_street,
        lyj_requirement_createdatetime,
        lyj_requirement_begindatetime,
        lyj_requirement_enddatetime,
        lyj_requirement_rawaddress,
        lyj_requirement_maplocation,
        lyj_requirement_reward,
        lyj_requirement_volunteerperfer
        FROM
        lyj_requirement_apply LEFT JOIN
        lyj_requirement on
        lyj_requirement_applyid = lyj_requirement_id

      <where>
          <if test="searchText!=null and searchText!='' ">
              lyj_requirement_name like #{pattern}
              or lyj_requirement_description like #{pattern}
              or lyj_requirement_city like #{pattern}
              or lyj_requirement_area like #{pattern}
              or lyj_requirement_street like #{pattern}
              or lyj_requirement_rawaddress like #{pattern}
          </if>

          <if test="userId!=null and userId!=0 ">

              <if test="searchText!=null and searchText!='' ">
                  and
              </if>
              lyj_requirement_createuser = #{userId,jdbcType=DECIMAL}
          </if>

          <if test="status!=null and status!=0 ">

              <if test="(userId!=null and userId!=0) or (searchText!=null and searchText!='')">
                  and
              </if>
              lyj_requirement_applystate = #{status,jdbcType=DECIMAL}
          </if>
      </where>

  </select>

</mapper>